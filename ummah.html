
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <title>WeMuslim - Ummah</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
    <!-- Google Fonts (Inter) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap" rel="stylesheet"/>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Style for the post list container */
        .post-list-container {
            background-color: #E6F0E9;
            padding: 24px;
            border-radius: 1rem;
            margin-top: 1.5rem;
            color: black;
        }

        /* Style for individual posts */
        .post-item {
            border-bottom: 1px solid #d1d5db;
            padding-bottom: 1rem;
            margin-bottom: 1rem;
        }
        /* Remove border and margin from the last post */
        .post-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .post-title {
            font-weight: 700;
            font-size: 1.125rem;
            margin-bottom: 0.5rem;
             color: #005B1A;
        }

        .post-content {
            font-size: 0.875rem;
            color: #374151;
             font-weight: 400;
        }

        .loading-message {
             text-align: center;
             font-size: 1rem;
             color: #007A2B;
             margin-top: 20px;
         }
         .no-posts-message {
             text-align: center;
             font-size: 1rem;
             color: #555;
             margin-top: 20px;
         }
         .error-message {
             color: #dc2626;
             font-size: 0.875rem;
             margin-top: 8px;
             text-align: center;
         }


    </style>
</head>
<body class="bg-white min-h-screen flex flex-col justify-between">

    <!-- Main Content Wrapper -->
    <div class="max-w-md mx-auto rounded-b-none md:rounded-b-3xl rounded-t-3xl overflow-hidden shadow-lg w-full md:w-full" style="background: linear-gradient(180deg, #007A2B 0%, #005B1A 100%)">
        <header class="flex items-center justify-between px-4 pt-4 text-white">
             <div class="flex-1"></div>
            <h1 class="text-lg font-semibold text-center flex-1">Ummah Feed</h1>
            <div class="flex space-x-4 text-white text-xl">
                 <button aria-label="Settings">
                    <i class="fas fa-cog"></i>
                 </button>
            </div>
        </header>
        <main class="px-6 pb-6 pt-2 flex flex-col items-center">

             <div class="post-list-container w-full">
                 <h2 class="text-xl font-semibold text-center text-[#007A2B] mb-6">Latest Posts</h2>

                 <div id="posts-list">
                     <p class="loading-message" id="loading-message">Loading posts...</p>
                     <!-- Posts will be loaded here by JavaScript -->
                 </div>

             </div>

             <nav aria-label="Quick access navigation" class="mt-6 flex justify-between px-2 bg-white rounded-xl py-3 shadow-md w-full">
                <button class="flex flex-col items-center space-y-1 text-xs text-black">
                    <img alt="Green Quran icon on stand" class="w-10 h-10" height="40" src="https://storage.googleapis.com/a1aa/image/f0c21e4d-85f6-46c1-b948-d9dd631c95fb.jpg" width="40"/>
                    <span>Quran</span>
                </button>
                <button class="flex flex-col items-center space-y-1 text-xs text-black">
                    <img alt="Green hands raised in prayer icon" class="w-10 h-10" height="40" src="https://storage.googleapis.com/a1aa/image/c368f998-46f1-4389-6cc5-cd25bbb274ea.jpg" width="40"/>
                    <span>Azkar</span>
                </button>
                <button class="flex flex-col items-center space-y-1 text-xs text-black">
                    <img alt="Green prayer beads (Tasbih) icon" class="w-10 h-10" height="40" src="https://storage.googleapis.com/a1aa/image/a5f2c70e-fb8f-4315-3ac0-82fc4697e04c.jpg" width="40"/>
                    <span>Tasbih</span>
                </button>
                <button class="flex flex-col items-center space-y-1 text-xs text-black">
                    <img alt="Green compass with Kaaba icon representing Qibla" class="w-10 h-10" height="40" src="https://storage.googleapis.com/a1aa/image/26790213-8a23-4205-5599-eb462ffab415.jpg" width="40"/>
                    <span>Qibla</span>
                </button>
                <button class="flex flex-col items-center space-y-1 text-xs text-black">
                    <img alt="Green squares icon representing More options" class="w-10 h-10" height="40" src="https://storage.googleapis.com/a1aa/image/e2a05ecd-7cef-47e4-9456-7426031b6437.jpg" width="40"/>
                    <span>More</span>
                </button>
            </nav>

            <section class="mt-6 bg-[#005B1A] rounded-3xl p-4 flex items-center space-x-4 text-[#D9E9B9] w-full">
                <div class="bg-[#007A2B] rounded-lg p-2">
                    <i class="fas fa-mosque text-[#D9E9B9] text-xl"></i>
                </div>
                <h2 class="font-semibold text-lg">Welcome to WeMuslim</h2>
                <div class="flex-1"></div>
                <img alt="Green mosque silhouette with golden arch decoration" class="w-20 h-14 object-contain" height="60" src="https://storage.googleapis.com/a1aa/image/920dbb0d-fb7c-4c06-fb09-b1f61c101e9b.jpg" width="80"/>
            </section>

        </main>
    </div>

    <nav class="max-w-md mx-auto bg-white rounded-t-none md:rounded-t-3xl rounded-b-3xl shadow-lg flex justify-around py-3 text-xs text-[#007A2B] font-semibold w-full md:w-full" id="bottom-nav">
        <button class="flex flex-col items-center space-y-1 text-green-300" data-nav="Home">
            <i class="fas fa-home text-lg"></i>
            <span>Home</span>
        </button>
        <button class="flex flex-col items-center space-y-1 text-[#007A2B]" data-nav="Ummah">
            <i class="fas fa-users-cog text-lg"></i>
            <span>Ummah</span>
        </button>
        <button class="flex flex-col items-center space-y-1 text-green-300" data-nav="Quran">
            <i class="fas fa-book-open text-lg"></i>
            <span>Quran</span>
        </button>
        <button class="flex flex-col items-center space-y-1 text-green-300" data-nav="Messages">
            <i class="fas fa-comments text-lg"></i>
            <span>Messages</span>
        </button>
        <button class="flex flex-col items-center space-y-1 text-green-300" data-nav="Me">
            <i class="fas fa-user text-lg"></i>
            <span>Me</span>
        </button>
    </nav>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <script>
        // --- YOUR ACTUAL FIREBASE CONFIGURATION (Derived from your google-services.json) ---
        const firebaseConfig = {
            apiKey: "AIzaSyD6EXA7D77rQDQEohB52BvTYimFeTEaAho",
            authDomain: "rn-gfx-tool.firebaseapp.com", // Inferred
            projectId: "rn-gfx-tool",
            storageBucket: "rn-gfx-tool.firebasestorage.app",
            messagingSenderId: "163149358541",
            appId: "1:163149358541:android:2ef6d22fcd23e77ee09084", // Note: Using the Web App ID from Firebase Console is best practice.
            databaseURL: "https://rn-gfx-tool-default-rtdb.asia-southeast1.firebasedatabase.app"
        };

         // Initialize Firebase (Only initialize if not already initialized)
        if (!firebase.apps.length) {
             firebase.initializeApp(firebaseConfig);
        }
        console.log("Firebase Initialized on ummah.html");


        const db = firebase.firestore(); // Get Firestore instance


        // --- Get UI Element for Posts ---
        const postsListElement = document.getElementById('posts-list');
        const loadingMessageElement = document.getElementById('loading-message');


        // --- Function to Fetch and Display Posts ---
        async function fetchAndDisplayPosts() {
             if (!postsListElement || !loadingMessageElement || !db) {
                 console.error("UI elements or Firestore not available.");
                 // Display a fallback message in the list area
                 if (postsListElement) postsListElement.innerHTML = '<p class="error-message">App initialization incomplete. Could not load posts.</p>';
                 if (loadingMessageElement) loadingMessageElement.classList.add('hidden');
                 return;
             }

            postsListElement.innerHTML = '';
            loadingMessageElement.classList.remove('hidden');

            try {
                const querySnapshot = await db.collection('posts').orderBy('timestamp', 'desc').get();

                if (querySnapshot.empty) {
                    postsListElement.innerHTML = '<p class="no-posts-message">No posts found.</p>';
                } else {
                    querySnapshot.forEach((doc) => {
                        const post = doc.data();
                        const postElement = document.createElement('div');
                        postElement.classList.add('post-item');
                         const sanitizedTitle = post.title ? post.title.replace(/</g, "&lt;").replace(/>/g, "&gt;") : 'Untitled Post';
                         const sanitizedContent = post.content ? post.content.replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/\n/g, '<br>') : 'No content.';

                        postElement.innerHTML = `
                            <h3 class="post-title">${sanitizedTitle}</h3>
                            <p class="post-content">${sanitizedContent}</p>
                             ${post.timestamp ? `<p class="text-xs text-gray-500 mt-2">Posted: ${post.timestamp.toDate().toLocaleString()}</p>` : ''}
                        `;
                        postsListElement.appendChild(postElement);
                    });
                }

            } catch (error) {
                console.error("Error fetching posts:", error);
                postsListElement.innerHTML = '<p class="error-message">Error loading posts. Please check Firebase setup and network connection.</p>';
            } finally {
                 loadingMessageElement.classList.add('hidden');
            }
        }


        // --- Initialize Page ---
        document.addEventListener('DOMContentLoaded', () => {

             fetchAndDisplayPosts();

             // Optional: Real-time listener (uncomment to enable)
             /*
             if (db) {
                 db.collection('posts').orderBy('timestamp', 'desc').onSnapshot(snapshot => {
                    if (!postsListElement || !loadingMessageElement) return;

                    postsListElement.innerHTML = '';
                    if (snapshot.empty) {
                        postsListElement.innerHTML = '<p class="no-posts-message">No posts found.</p>';
                    } else {
                         snapshot.forEach(doc => {
                             const post = doc.data();
                             const postElement = document.createElement('div');
                             postElement.classList.add('post-item');
                             const sanitizedTitle = post.title ? post.title.replace(/</g, "&lt;").replace(/>/g, "&gt;") : 'Untitled Post';
                             const sanitizedContent = post.content ? post.content.replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/\n/g, '<br>') : 'No content.';
                             postElement.innerHTML = `
                                 <h3 class="post-title">${sanitizedTitle}</h3>
                                 <p class="post-content">${sanitizedContent}</p>
                                  ${post.timestamp ? `<p class="text-xs text-gray-500 mt-2">Posted: ${post.timestamp.toDate().toLocaleString()}</p>` : ''}
                             `;
                             postsListElement.appendChild(postElement);
                         });
                    }
                    loadingMessageElement.classList.add('hidden');

                 }, error => {
                    console.error("Error listening to posts:", error);
                     if (!postsListElement || !loadingMessageElement) return;
                    loadingMessageElement.classList.add('hidden');
                    postsListElement.innerHTML = '<p class="error-message">Error loading posts in real-time.</p>';
                 });
             } else {
                  console.error("Firestore not initialized. Cannot fetch posts.");
                  if (postsListElement) postsListElement.innerHTML = '<p class="error-message">Firebase not connected. Cannot load posts.</p>';
                  if (loadingMessageElement) loadingMessageElement.classList.add('hidden');
             }
             */


             // --- Footer Navigation Logic ---
             document.querySelectorAll('#bottom-nav button').forEach(button => {
                 button.addEventListener('click', (event) => {
                     const navAction = button.dataset.nav;
                     console.log(`Navigating to ${navAction}`);
                      if (navAction === 'Home') {
                          window.location.href = 'index.html';
                      } else if (navAction === 'Ummah') {
                         // Stay on ummah.html
                         // window.location.reload();
                      } else if (navAction === 'Me') {
                         window.location.href = 'me.html';
                      } else {
                           alert(`Navigating to ${navAction} (Placeholder)`);
                      }
                 });
             });

              // Optional: Keep settings button functionality (e.g., show an alert)
              const settingsBtn = document.querySelector('header button[aria-label="Settings"]');
              if(settingsBtn) {
                  settingsBtn.addEventListener('click', () => {
                      alert("Settings for the 'Ummah' page (Placeholder)");
                  });
              }


        });

    </script>
</body>
</html>