<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <title>WeMuslim - Me</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
    <!-- Google Fonts (Inter) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
         .auth-container, .profile-container {
             background-color: #E6F0E9;
             padding: 24px;
             border-radius: 1rem;
             margin-top: 1.5rem;
             color: black;
             font-weight: 600;
             text-align: center;
         }
        .auth-container input[type="email"],
        .auth-container input[type="password"] {
            width: 100%;
            padding: 12px;
            margin-bottom: 16px;
            border-radius: 8px;
            border: 1px solid #ccc;
             font-size: 1rem;
             font-weight: 400;
        }
         .auth-button {
             display: block;
             width: 100%;
             padding: 12px;
             border-radius: 8px;
             font-size: 1rem;
             font-weight: 700;
             text-align: center;
             cursor: pointer;
             transition: background-color 0.2s ease;
         }
         .auth-button-primary {
             background-color: #007A2B;
             color: white;
         }
         .auth-button-primary:hover {
             background-color: #005B1A;
         }
          .auth-button-google {
              background-color: #DB4437;
              color: white;
              margin-top: 10px;
          }
           .auth-button-google:hover {
               background-color: #c23321;
           }

         .error-message {
             color: #dc2626;
             font-size: 0.875rem;
             margin-top: 8px;
             margin-bottom: 16px;
             text-align: center;
         }

         .profile-container p {
             margin-bottom: 10px;
         }

         .profile-container .logout-button {
             margin-top: 20px;
             background-color: #dc2626;
             color: white;
         }
          .profile-container .logout-button:hover {
               background-color: #b91c1c;
          }

          .profile-photo {
              width: 80px;
              height: 80px;
              border-radius: 50%;
              object-fit: cover;
              margin: 0 auto 15px auto;
              border: 3px solid #007A2B;
          }

          .hidden {
              display: none;
          }

    </style>
</head>
<body class="bg-white min-h-screen flex flex-col justify-between">

    <!-- Main Content Wrapper -->
    <div class="max-w-md mx-auto rounded-b-none md:rounded-b-3xl rounded-t-3xl overflow-hidden shadow-lg w-full md:w-full" style="background: linear-gradient(180deg, #007A2B 0%, #005B1A 100%)">
        <header class="flex items-center justify-between px-4 pt-4 text-white">
            <div class="flex-1"></div>
            <h1 class="text-lg font-semibold text-center flex-1">Me</h1>
            <div class="flex space-x-4 text-white text-xl">
                 <button aria-label="Settings">
                    <i class="fas fa-cog"></i>
                 </button>
            </div>
        </header>
        <main class="px-6 pb-6 pt-2 flex flex-col items-center">
             <div id="auth-container" class="w-full">
                 <div id="auth-form" class="auth-container">
                     <h2 class="text-xl font-semibold text-center text-[#007A2B] mb-6">Login / Sign Up</h2>
                     <input type="email" id="email-input" placeholder="Email Address" autocomplete="email"/>
                     <input type="password" id="password-input" placeholder="Password" autocomplete="current-password"/>
                     <button id="login-button" class="auth-button auth-button-primary mb-3">Login</button>
                     <button id="signup-button" class="auth-button auth-button-primary">Sign Up</button>

                     <div class="text-center my-4 text-gray-600">OR</div>

                     <button id="google-signin-button" class="auth-button auth-button-google">
                         <i class="fab fa-google mr-2"></i> Sign in with Google
                     </button>

                     <p id="auth-error-message" class="error-message hidden"></p>
                 </div>

                 <div id="profile-display" class="profile-container hidden">
                     <h2 class="text-xl font-semibold text-center text-[#007A2B] mb-6">My Profile</h2>
                      <img id="profile-photo" class="profile-photo" src="" alt="Profile Photo Placeholder"/>
                     <p id="profile-email"></p>
                     <p id="profile-name"></p>

                     <button id="logout-button" class="auth-button logout-button">Logout</button>
                 </div>
             </div>

             <nav aria-label="Quick access navigation" class="mt-6 flex justify-between px-2 bg-white rounded-xl py-3 shadow-md w-full">
                <button class="flex flex-col items-center space-y-1 text-xs text-black">
                    <img alt="Green Quran icon on stand" class="w-10 h-10" height="40" src="https://storage.googleapis.com/a1aa/image/f0c21e4d-85f6-46c1-b948-d9dd631c95fb.jpg" width="40"/>
                    <span>Quran</span>
                </button>
                <button class="flex flex-col items-center space-y-1 text-xs text-black">
                    <img alt="Green hands raised in prayer icon" class="w-10 h-10" height="40" src="https://storage.googleapis.com/a1aa/image/c368f998-46f1-4389-6cc5-cd25bbb274ea.jpg" width="40"/>
                    <span>Azkar</span>
                </button>
                <button class="flex flex-col items-center space-y-1 text-xs text-black">
                    <img alt="Green prayer beads (Tasbih) icon" class="w-10 h-10" height="40" src="https://storage.googleapis.com/a1aa/image/a5f2c70e-fb8f-4315-3ac0-82fc4697e04c.jpg" width="40"/>
                    <span>Tasbih</span>
                </button>
                <button class="flex flex-col items-center space-y-1 text-xs text-black">
                    <img alt="Green compass with Kaaba icon representing Qibla" class="w-10 h-10" height="40" src="https://storage.googleapis.com/a1aa/image/26790213-8a23-4205-5599-eb462ffab415.jpg" width="40"/>
                    <span>Qibla</span>
                </button>
                <button class="flex flex-col items-center space-y-1 text-xs text-black">
                    <img alt="Green squares icon representing More options" class="w-10 h-10" height="40" src="https://storage.googleapis.com/a1aa/image/e2a05ecd-7cef-47e4-9456-7426031b6437.jpg" width="40"/>
                    <span>More</span>
                </button>
            </nav>

            <section class="mt-6 bg-[#005B1A] rounded-3xl p-4 flex items-center space-x-4 text-[#D9E9B9] w-full">
                <div class="bg-[#007A2B] rounded-lg p-2">
                    <i class="fas fa-mosque text-[#D9E9B9] text-xl"></i>
                </div>
                <h2 class="font-semibold text-lg">Welcome to WeMuslim</h2>
                <div class="flex-1"></div>
                <img alt="Green mosque silhouette with golden arch decoration" class="w-20 h-14 object-contain" height="60" src="https://storage.googleapis.com/a1aa/image/920dbb0d-fb7c-4c06-fb09-b1f61c101e9b.jpg" width="80"/>
            </section>

        </main>
    </div>

    <nav class="max-w-md mx-auto bg-white rounded-t-none md:rounded-t-3xl rounded-b-3xl shadow-lg flex justify-around py-3 text-xs text-[#007A2B] font-semibold w-full md:w-full" id="bottom-nav">
        <button class="flex flex-col items-center space-y-1 text-green-300" data-nav="Home">
            <i class="fas fa-home text-lg"></i>
            <span>Home</span>
        </button>
        <button class="flex flex-col items-center space-y-1 text-green-300" data-nav="Ummah">
            <i class="fas fa-users-cog text-lg"></i>
            <span>Ummah</span>
        </button>
        <button class="flex flex-col items-center space-y-1 text-green-300" data-nav="Quran">
            <i class="fas fa-book-open text-lg"></i>
            <span>Quran</span>
        </button>
        <button class="flex flex-col items-center space-y-1 text-green-300" data-nav="Messages">
            <i class="fas fa-comments text-lg"></i>
            <span>Messages</span>
        </button>
        <button class="flex flex-col items-center space-y-1 text-[#007A2B]" data-nav="Me">
            <i class="fas fa-user text-lg"></i>
            <span>Me</span>
        </button>
    </nav>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <script>
        // --- YOUR ACTUAL FIREBASE CONFIGURATION (Derived from your google-services.json) ---
        const firebaseConfig = {
            apiKey: "AIzaSyD6EXA7D77rQDQEohB52BvTYimFeTEaAho",
            authDomain: "rn-gfx-tool.firebaseapp.com", // Inferred
            projectId: "rn-gfx-tool",
            storageBucket: "rn-gfx-tool.firebasestorage.app",
            messagingSenderId: "163149358541",
            appId: "1:163149358541:android:2ef6d22fcd23e77ee09084", // Note: Using the Web App ID from Firebase Console is best practice.
            databaseURL: "https://rn-gfx-tool-default-rtdb.asia-southeast1.firebasedatabase.app"
        };

         // Initialize Firebase (Only initialize if not already initialized)
        if (!firebase.apps.length) {
             firebase.initializeApp(firebaseConfig);
        }
        console.log("Firebase Initialized on me.html");


        const auth = firebase.auth();
        const db = firebase.firestore();
        const googleProvider = new firebase.auth.GoogleAuthProvider();


        // --- Get UI Elements ---
        const authFormDiv = document.getElementById('auth-form');
        const profileDisplayDiv = document.getElementById('profile-display');
        const emailInput = document.getElementById('email-input');
        const passwordInput = document.getElementById('password-input');
        const loginButton = document.getElementById('login-button');
        const signupButton = document.getElementById('signup-button');
        const googleSignInButton = document.getElementById('google-signin-button');
        const logoutButton = document.getElementById('logout-button');
        const authErrorMessage = document.getElementById('auth-error-message');
        const profileEmail = document.getElementById('profile-email');
        const profileName = document.getElementById('profile-name');
        const profilePhoto = document.getElementById('profile-photo');


        // --- Show/Hide Functions ---
        function showAuthForm() {
            if(authFormDiv) authFormDiv.classList.remove('hidden');
            if(profileDisplayDiv) profileDisplayDiv.classList.add('hidden');
             if(authErrorMessage) authErrorMessage.classList.add('hidden');
        }

        function showProfileDisplay(user) {
            if(authFormDiv) authFormDiv.classList.add('hidden');
            if(profileDisplayDiv) profileDisplayDiv.classList.remove('hidden');
             if(authErrorMessage) authErrorMessage.classList.add('hidden');

             if(profileEmail) profileEmail.textContent = `Email: ${user.email || 'N/A'}`;
             if(profileName) profileName.textContent = `Name: ${user.displayName || 'N/A'}`;
             if(profilePhoto) {
                 profilePhoto.src = user.photoURL || 'https://upload.wikimedia.org/wikipedia/commons/7/7c/Profile_avatar_placeholder_large.png?20150327203541';
                 profilePhoto.alt = user.displayName || 'Profile photo';
             }


             // Optional: Fetch user data from Firestore if needed
             // db.collection('users').doc(user.uid).get().then(...).catch(...)
        }

        function displayError(message) {
             if(!authErrorMessage) return;
            authErrorMessage.textContent = message;
            authErrorMessage.classList.remove('hidden');
        }

        // --- Auth State Listener ---
        if (auth) {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    console.log("User logged in:", user.email, user.uid);
                    showProfileDisplay(user);
                } else {
                    console.log("User logged out");
                    showAuthForm();
                }
            });
        } else {
             console.error("Firebase Auth SDK not loaded on me.html.");
        }


        // --- Authentication Functions ---
        document.addEventListener('DOMContentLoaded', () => {

            if(loginButton && emailInput && passwordInput && auth) {
                loginButton.addEventListener('click', () => {
                    const email = emailInput.value;
                    const password = passwordInput.value;
                    if(authErrorMessage) authErrorMessage.classList.add('hidden');

                    auth.signInWithEmailAndPassword(email, password)
                        .then((userCredential) => {
                            console.log("Logged in successfully with email:", userCredential.user.email);
                        })
                        .catch((error) => {
                            console.error("Login Error:", error);
                            displayError(error.message);
                        });
                });
            }


            if(signupButton && emailInput && passwordInput && auth) {
                signupButton.addEventListener('click', () => {
                     const email = emailInput.value;
                    const password = passwordInput.value;
                    if(authErrorMessage) authErrorMessage.classList.add('hidden');

                     if (password.length < 6) {
                         displayError("Password should be at least 6 characters.");
                         return;
                     }

                    auth.createUserWithEmailAndPassword(email, password)
                        .then((userCredential) => {
                            console.log("Signed up and logged in successfully with email:", userCredential.user.email);
                             // Optional: Save new user info to Firestore
                             // if (db) { // Check if db is initialized
                             //     db.collection('users').doc(userCredential.user.uid).set({
                             //         email: userCredential.user.email,
                             //         displayName: userCredential.user.displayName,
                             //         photoURL: userCredential.user.photoURL,
                             //         createdAt: firebase.firestore.FieldValue.serverTimestamp()
                             //     }).then(() => {
                             //        console.log("User data saved to DB");
                             //     }).catch(error => {
                             //        console.error("Error saving user data to DB:", error);
                             //     });
                             // } else {
                             //      console.warn("Firestore not initialized. User data not saved to DB.");
                             // }

                        })
                        .catch((error) => {
                             console.error("Sign Up Error:", error);
                            displayError(error.message);
                        });
                });
             }


            if(googleSignInButton && auth) {
                googleSignInButton.addEventListener('click', () => {
                     if(authErrorMessage) authErrorMessage.classList.add('hidden');

                     auth.signInWithPopup(googleProvider)
                        .then((result) => {
                            const user = result.user;
                            console.log("Logged in successfully with Google:", user.email);
                             // Optional: Check/save user data in DB
                             // if(db) { // Check if db is initialized
                             //    const userRef = db.collection('users').doc(user.uid);
                             //    userRef.get().then(doc => { ... }).catch(...)
                             // }
                        }).catch((error) => {
                            console.error("Google Sign-in Error:", error);
                             displayError(error.message);
                        });
                });
            }


            if(logoutButton && auth) {
                logoutButton.addEventListener('click', () => {
                    auth.signOut()
                        .then(() => {
                            console.log("User signed out successfully");
                            if(emailInput) emailInput.value = '';
                            if(passwordInput) passwordInput.value = '';
                        })
                        .catch((error) => {
                            console.error("Logout Error:", error);
                        });
                });
            }


             // --- Footer Navigation Logic ---
             document.querySelectorAll('#bottom-nav button').forEach(button => {
                 button.addEventListener('click', (event) => {
                     const navAction = button.dataset.nav;
                     console.log(`Navigating to ${navAction}`);
                      // Navigate based on data-nav attribute
                      if (navAction === 'Home') {
                          window.location.href = 'index.html';
                      } else if (navAction === 'Ummah') {
                         window.location.href = 'ummah.html';
                      } else if (navAction === 'Me') {
                         // Stay on me.html
                         // window.location.reload();
                      } else {
                           alert(`Navigating to ${navAction} (Placeholder)`);
                      }
                 });
             });

              // Optional: Keep settings button functionality (e.g., show an alert)
               const settingsBtn = document.querySelector('header button[aria-label="Settings"]');
              if(settingsBtn) {
                  settingsBtn.addEventListener('click', () => {
                      alert("Settings for the 'Me' page (Placeholder)");
                  });
              }


        }); // End DOMContentLoaded

    </script>
</body>
</html>